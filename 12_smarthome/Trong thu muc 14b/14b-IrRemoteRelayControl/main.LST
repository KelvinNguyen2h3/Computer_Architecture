C51 COMPILER V9.60.7.0   MAIN                                                              11/13/2023 10:54:18 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\00-libfiles) DEBUG OBJECTEXTEN
                    -D TABS(2)

line level    source

   1          #include <reg51.h>
   2          #include "stdutils.h"
   3          #include "nec_ir.h"
   4          #include "XPT2046.h"
   5          
   6          sbit LED1=P2^0;
   7          sbit LED2=P2^1;
   8          sbit LED3=P2^2;
   9          sbit LED4=P2^3;
  10          sbit LED5=P2^4;
  11          sbit LED6=P2^5;
  12          sbit LED7=P2^6;
  13          sbit LED8=P2^7;
  14          sbit DIGIT_1 = P2^2;
  15          sbit DIGIT_2 = P2^3;
  16          sbit DIGIT_3 = P2^4;
  17          typedef unsigned int     u16;
  18          typedef unsigned int    u8;
  19           
  20          #define KEY_MATRIX_PORT     P1
  21          #define SMG_SEG_PORT        P0
  22          
  23          u8 gsmg_code[16]={0x00,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  24                           0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  25          void displayDigit(unsigned char digit) {
  26   1          switch (digit) {
  27   2              case 0: P0 = 0x00; break; 
  28   2              case 1: P0 = 0x06; break;
  29   2              case 2: P0 = 0x5b; break;
  30   2              case 3: P0 = 0x4f; break;
  31   2              case 4: P0 = 0x66; break;
  32   2              case 5: P0 = 0x6d; break;
  33   2              case 6: P0 = 0x7d; break;
  34   2              case 7: P0 = 0x07; break;
  35   2              case 8: P0 = 0x7f; break;
  36   2              case 9: P0 = 0x6f; break;
  37   2              default: P0 = 0x00; break;
  38   2          }
  39   1      }
  40          
  41          void delay_10us(int ten_us)
  42          {
  43   1           while(ten_us--);
  44   1      } 
  45          
  46          int key_matrix_ranks_scan(int key)
  47          {
  48   1      u8 key_value;
  49   1           KEY_MATRIX_PORT=0xf7;
  50   1           if(KEY_MATRIX_PORT!=0xf7)
  51   1           {
  52   2                delay_10us(1000);
  53   2               switch(KEY_MATRIX_PORT)
  54   2            {
C51 COMPILER V9.60.7.0   MAIN                                                              11/13/2023 10:54:18 PAGE 2   

  55   3                   case 0x77: key_value=8;break;
  56   3                   case 0xb7: key_value=5;break;
  57   3                   case 0xd7: key_value=2;break;
  58   3                   case 0xe7: key_value=1;break;
  59   3               }
  60   2           }
  61   1          KEY_MATRIX_PORT=0xfb;
  62   1           if(KEY_MATRIX_PORT!=0xfb)
  63   1           {
  64   2                delay_10us(1000);
  65   2           switch(KEY_MATRIX_PORT)
  66   2               {
  67   3                   case 0x7b: key_value=9;break;
  68   3                   case 0xbb: key_value=6;break;
  69   3                   case 0xdb: key_value=3;break;
  70   3                   case 0xeb: key_value=14;break;
  71   3              }
  72   2           }
  73   1      
  74   1           KEY_MATRIX_PORT=0xfd;
  75   1           if(KEY_MATRIX_PORT!=0xfd)
  76   1             {
  77   2                delay_10us(1000);
  78   2               switch(KEY_MATRIX_PORT)
  79   2               {
  80   3                   case 0x7d: key_value=10;break;
  81   3                   case 0xbd: key_value=7;break;
  82   3                   case 0xdd: key_value=4;break;
  83   3                   case 0xed: key_value=15;break;
  84   3               }
  85   2           }
  86   1           KEY_MATRIX_PORT=0xfe;
  87   1      if(KEY_MATRIX_PORT!=0xfe || key != 0)
  88   1           {
  89   2                delay_10us(1000);
  90   2                key_value=12;
  91   2           }
  92   1           return key_value;
  93   1         }
  94          
  95          void main()
  96          {
  97   1        
  98   1          uint temp,count1;
  99   1          uint32_t key;
 100   1          u8 k;
 101   1          u8 count=0;
 102   1          u8 ledState1 = 0;
 103   1          u8 ledState2 = 0;
 104   1          u8 ledState3 = 0;
 105   1          u8 ledState4 = 0;
 106   1          u8 ledState5 = 0;
 107   1          u8 ledState6 = 0;
 108   1          u8 ledState7 = 0;
 109   1          u8 ledState8 = 0;
 110   1          IR_RemoteInit();
 111   1          while(1)
 112   1          {
 113   2            if(count1==50)
 114   2          {
 115   3            count1=0; 
 116   3            temp = Read_AD_Data(0xA4);  
C51 COMPILER V9.60.7.0   MAIN                                                              11/13/2023 10:54:18 PAGE 3   

 117   3          }
 118   2          count1++;
 119   2            if (temp < 70)
 120   2                {
 121   3                  P2 = 0x00;
 122   3                }
 123   2              key = IR_RemoteGetKey();
 124   2              switch(key)
 125   2              {
 126   3                case IR_CODE_1: 
 127   3                              if (ledState1 == 0) {
 128   4                                  displayDigit(1); 
 129   4                                  DIGIT_1 = 1; 
 130   4                                  DIGIT_2 = 1; 
 131   4                                  DIGIT_3 = 1; 
 132   4                                  ledState1 = 1;
 133   4                              } else {
 134   4                                  displayDigit(0);
 135   4                                  ledState1 = 0;
 136   4                              }
 137   3                              break;
 138   3                case IR_CODE_2: 
 139   3                              if (ledState2 == 0) {
 140   4                                  displayDigit(2); 
 141   4                                  DIGIT_1 = 0; 
 142   4                                  DIGIT_2 = 1; 
 143   4                                  DIGIT_3 = 1; 
 144   4                                  ledState2 = 1;
 145   4                              } else {
 146   4                                  displayDigit(0); 
 147   4                                  ledState2 = 0;
 148   4                              }
 149   3                              break;
 150   3                case IR_CODE_3: 
 151   3                              if (ledState3 == 0) {
 152   4                                  displayDigit(3); 
 153   4                                  DIGIT_1 = 1; 
 154   4                                  DIGIT_2 = 0; 
 155   4                                  DIGIT_3 = 1; 
 156   4                                  ledState3 = 1;
 157   4                              } else {
 158   4                                  displayDigit(0);
 159   4                                  ledState3 = 0;
 160   4                              }
 161   3                              break;
 162   3                
 163   3                              
 164   3                case IR_CODE_4: 
 165   3                              if (ledState4 == 0) {
 166   4                                  displayDigit(4); 
 167   4                                  DIGIT_1 = 0; 
 168   4                                  DIGIT_2 = 0; 
 169   4                                  DIGIT_3 = 1; 
 170   4                                  ledState4 = 1;
 171   4                              } else {
 172   4                                  displayDigit(0); 
 173   4                                  ledState4 = 0;
 174   4                              }
 175   3                              break;
 176   3                case IR_CODE_5: 
 177   3                              if (ledState5 == 0) {
 178   4                                  displayDigit(5);
C51 COMPILER V9.60.7.0   MAIN                                                              11/13/2023 10:54:18 PAGE 4   

 179   4                                  ledState5 = 1;
 180   4                              } else {
 181   4                                  displayDigit(0); 
 182   4                                  DIGIT_1 = 0; 
 183   4                                  DIGIT_2 = 0; 
 184   4                                  DIGIT_3 = 0; 
 185   4                                  ledState5 = 0;
 186   4                              }
 187   3                              break;
 188   3                case IR_CODE_6: 
 189   3                              if (ledState6 == 0) {
 190   4                                  displayDigit(6); 
 191   4                                  DIGIT_1 = 0; 
 192   4                                  DIGIT_2 = 1; 
 193   4                                  DIGIT_3 = 0; 
 194   4                                  ledState6 = 1;
 195   4                              } else {
 196   4                                  displayDigit(0);
 197   4                                  ledState6 = 0;
 198   4                              }
 199   3                              break;
 200   3                case IR_CODE_7: 
 201   3                              if (ledState7 == 0) {
 202   4                                  displayDigit(7); 
 203   4                                  DIGIT_1 = 1; 
 204   4                                  DIGIT_2 = 0; 
 205   4                                  DIGIT_3 = 0; 
 206   4                                  ledState7 = 1;
 207   4                              } else {
 208   4                                  displayDigit(0);
 209   4                                  ledState7 = 0;
 210   4                              }
 211   3                              break;
 212   3                case IR_CODE_8: 
 213   3                              if (ledState8 == 0) {
 214   4                                  displayDigit(8); 
 215   4                                  DIGIT_1 = 0; 
 216   4                                  DIGIT_2 = 0; 
 217   4                                  DIGIT_3 = 0; 
 218   4                                  ledState8 = 1;
 219   4                              } else {
 220   4                                  displayDigit(0);
 221   4                                  ledState8 = 0;
 222   4                              }
 223   3                              break;
 224   3                default: break;
 225   3              }
 226   2              k = key_matrix_ranks_scan(key);
 227   2              switch(k-1)
 228   2              {
 229   3                case 1: displayDigit(1); DIGIT_1 = 1; DIGIT_2 = 1; DIGIT_3 = 1; break;
 230   3                case 2: displayDigit(2); DIGIT_1 = 0; DIGIT_2 = 1; DIGIT_3 = 1; break;
 231   3                case 3: displayDigit(3); DIGIT_1 = 1; DIGIT_2 = 0; DIGIT_3 = 1; break;
 232   3                case 4: displayDigit(4); DIGIT_1 = 0; DIGIT_2 = 0; DIGIT_3 = 1; break;
 233   3                case 5: displayDigit(5); DIGIT_1 = 1; DIGIT_2 = 1; DIGIT_3 = 0; break;
 234   3                case 6: displayDigit(6); DIGIT_1 = 0; DIGIT_2 = 1; DIGIT_3 = 0; break;
 235   3                case 7: displayDigit(7); DIGIT_1 = 1; DIGIT_2 = 0; DIGIT_3 = 0; break;
 236   3                case 8: displayDigit(8); DIGIT_1 = 0; DIGIT_2 = 0; DIGIT_3 = 0; break;
 237   3                case 9: LED1=1; LED2=1; LED3=1; LED4=1; LED5=1; LED6=1; LED7=1; LED8=1; break;
 238   3                default: break;
 239   3              }
 240   2          }   
C51 COMPILER V9.60.7.0   MAIN                                                              11/13/2023 10:54:18 PAGE 5   

 241   1      }   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    922    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32      28
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
